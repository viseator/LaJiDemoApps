package xyz.viseator.v2ex.ui;import android.os.Bundle;import android.support.v4.app.Fragment;import android.support.v7.widget.LinearLayoutManager;import android.support.v7.widget.RecyclerView;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import java.net.MalformedURLException;import java.net.URL;import cn.bingoogolapple.refreshlayout.BGANormalRefreshViewHolder;import cn.bingoogolapple.refreshlayout.BGARefreshLayout;import cn.bingoogolapple.refreshlayout.BGARefreshViewHolder;import xyz.viseator.v2ex.R;import xyz.viseator.v2ex.http.GetHtmlListTask;import xyz.viseator.v2ex.http.GetListTask;/** * Created by viseator on 2016/11/23. */public class MainRecyclerViewFragment extends Fragment implements BGARefreshLayout.BGARefreshLayoutDelegate {    private final static String TAG = "wudi Fragment";    private final static String HOT_URL = "https://www.v2ex.com/api/topics/hot.json";    private final static String LATEST_URL = "https://www.v2ex.com/api/topics/latest.json";    private final static String PROGRAMMER_URL = "https://www.v2ex.com/go/programmer?p=";    private final static String ANDROID_URL = "https://www.v2ex.com/go/android?p=";    private BGARefreshLayout bgaRefreshLayout;    private RecyclerView recyclerView;    private static int page = 0;    private URL url;    private GetListTask getListTask;    private GetHtmlListTask getHtmlListTask;    private int position;    public void setPosition(int position) {        this.position = position;    }    public MainRecyclerViewFragment() {    }    @Override    public void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);    }    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {        View rootView = inflater.inflate(R.layout.main_fragment, container, false);        recyclerView = (RecyclerView) rootView.findViewById(R.id.main_recyclerview);        bgaRefreshLayout = (BGARefreshLayout) rootView.findViewById(R.id.main_refreshlayout);        initFreshLayout();        recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));        recyclerView.hasFixedSize();        setRecyclerView();        return rootView;    }    private void initFreshLayout() {        bgaRefreshLayout.setDelegate(this);        BGARefreshViewHolder bgaRefreshViewHolder = new BGANormalRefreshViewHolder(                getContext(), true);        bgaRefreshLayout.setRefreshViewHolder(bgaRefreshViewHolder);        bgaRefreshLayout.setCustomHeaderView(null, true);    }    private void setRecyclerView() {        try {            switch (position) {                case 0:                    url = new URL(LATEST_URL);                    getListTask = new GetListTask(getActivity(), recyclerView, bgaRefreshLayout);                    getListTask.execute(url);                    break;                case 1:                    url = new URL(HOT_URL);                    getListTask = new GetListTask(getActivity(), recyclerView, bgaRefreshLayout);                    getListTask.execute(url);                    break;                case 2:                    getHtmlListTask = new GetHtmlListTask(getActivity(), recyclerView,                            bgaRefreshLayout, page);                    getHtmlListTask.execute(PROGRAMMER_URL);                    break;                case 3:                    getHtmlListTask = new GetHtmlListTask(getActivity(), recyclerView,                            bgaRefreshLayout, page);                    getHtmlListTask.execute(ANDROID_URL);            }        } catch (MalformedURLException e) {            Log.d(TAG, "URL error");            e.printStackTrace();        }    }    @Override    public void onBGARefreshLayoutBeginRefreshing(BGARefreshLayout refreshLayout) {        setRecyclerView();    }    @Override    public boolean onBGARefreshLayoutBeginLoadingMore(BGARefreshLayout refreshLayout) {        if (position < 2) return false;        page++;        setRecyclerView();        Log.d(TAG, "LoadingMore");        return true;    }}